---
title: Route Management
description: Seamless authentication routing for Flutter applications
---

## Overview

Butterfly's Route Management provides a streamlined way to handle authentication flows in your Flutter application. It works alongside your existing routing solution (currently supporting Go Router) to automatically manage protected routes, authentication redirects, and deep linking.

## Supported Routers

- âœ… Go Router (current implementation)
- ğŸš§ Auto Route (planned)
- âœ… Custom (user implementation)

## Key Features

- ğŸ”’ Automatic route protection
- ğŸ”„ Seamless auth redirects
- ğŸ”— Deep link support
- ğŸ› Built-in debug routes
- ğŸ“Š Detailed logging

## Getting Started

### 1. Add Dependencies

```yaml
dependencies:
  core_management_route_go_router: ^latest_version
  go_router: ^10.0.0  # or latest
```

### 2. Create Your Router Service

```dart
import 'package:go_router/go_router.dart';
import 'package:core_management_route_go_router/core_management_route_go_router.dart';

class AppRouter extends GoRouterService with GoRouterAuthRoute<User> {
  AppRouter() : super(
    routes: [
      // Your route definitions here
      GoRoute(
        path: '/',
        builder: (context, state) => const HomePage(),
      ),
      GoRoute(
        path: '/profile',
        builder: (context, state) => const ProfilePage(),
      ),
    ],
    errorBuilder: (context, state) => ErrorPage(error: state.error),
  );

  @override
  User? get user => AuthService.currentUser;  // Must be synchronous

  @override
  List<String> get publicRoutes => [
    '/',         // Homepage is public
    '/about',    // About page is public
  ];

  @override
  List<String> get authTriggerRoutes => [
    '/login',    // Routes that trigger auth flow
    '/signup',
  ];

  @override
  String get signInRoutePath => '/login';
  
  @override
  String get signUpRoutePath => '/signup';
  
  @override
  String get defaultAuthRoute => '/';
}
```

## How It Works

### Authentication Flow

1. When a user tries to access a protected route:
   - If user is logged in (`user != null`): Access granted
   - If user is not logged in: Redirected to `signInRoutePath`

2. After successful login:
   - If user came from a protected route: Redirects back to original route
   - If user came from an auth route (login/signup): Redirects to `defaultAuthRoute`

### Public Routes

Mark routes as public by adding them to the `publicRoutes` list:

```dart
@override
List<String> get publicRoutes => [
  '/',
  '/about',
  '/privacy',
];
```

### Debug Routes

For development, you can bypass authentication using debug routes:

```dart
@override
List<String> get debugRoutes => [
  '/debug/profile',
  '/debug/settings',
];
```

## Deep Linking

Deep linking works out of the box. When a user opens a protected deep link:

1. If not logged in: Redirected to login
2. After login: Automatically taken to the deep-linked content

## Logging

Detailed route changes are logged in debug mode:

```
ğŸ”„ AUTH ROUTER EVENT
â”œâ”€ ğŸ“ Path: /profile
â”œâ”€ ğŸ”— Full URL: /profile?ref=email
â”œâ”€ ğŸ” Auth Required: true
â””â”€ ğŸ‘¤ User: User(id: 123)
```

## Removing the Feature

This package is designed to be non-intrusive. If you need to remove it:

1. Copy the base router implementation
2. Remove the `GoRouterAuthRoute` mixin
3. Implement your own auth logic

## Common Questions

### Why use this instead of direct Go Router?

- Handles common auth patterns automatically
- Reduces boilerplate code
- Consistent behavior across apps
- Built-in debug tools

### How to handle custom auth states?

Override the `goRouterRedirect` method in your router:

```dart
@override
FutureOr<String?> goRouterRedirect(
  BuildContext context,
  GoRouterState state,
) async {
  // Your custom logic here
  return await super.goRouterRedirect(context, state);
}
```

## Troubleshooting

### Routes not protecting
- Ensure `user` getter is properly implemented
- Check if route is in `publicRoutes`
- Verify `authTriggerRoutes` are correctly set

### Redirect loops
- Make sure `signInRoutePath` is in `authTriggerRoutes`
- Check for circular redirects in your route definitions
- Ensure `user` getter is synchronous

## Related Resources

- [Go Router Documentation](https://pub.dev/packages/go_router)
- [Flutter Navigation Guide](https://docs.flutter.dev/development/ui/navigation)
